- move check for entry end to shared function